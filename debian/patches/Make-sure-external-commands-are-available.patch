From: Andrea Bolognani <eof@kiyuko.org>
Date: Wed, 1 Feb 2012 11:33:54 +0100
Subject: Make sure external commands are available

External commands are not guaranteed to be available on the
system, so test for their existence before running them.

Forwarded: Marv Boyes <greyspace@tuxfamily.org>
---
 rhinote.py | 29 +++++++++++++++++++++++++++--
 1 file changed, 27 insertions(+), 2 deletions(-)

diff --git a/rhinote.py b/rhinote.py
index 4618555..8b9f38a 100644
--- a/rhinote.py
+++ b/rhinote.py
@@ -81,14 +81,19 @@ class TextWidget(Tkinter.Text):
         Rhinote()
 
     def printfile(self, whatever = None):
+        if not self.printcommand:
+            tkMessageBox.showerror('Print error', 'Print command (lpr) not found')
+            return
+        if not self.formatcommand:
+            tkMessageBox.showerror('Print error', 'Format command (enscript) not found')
+            return
         # Use a secure temp file for printing
         f = tempfile.NamedTemporaryFile(prefix = 'Rhinoteprintfile-', delete = False)
         f.write(self.get('1.0', 'end'))
         f.close()
         # 'enscript' formats the text; lpr sends it to the default printer;
         # enscript's -B option suppresses page headers.
-        os.system('enscript -B --word-wrap %s > lpr &' % f.name)
-        os.unlink(f.name)
+        os.system('%s -B --word-wrap %s > %s &' % (self.formatcommand, f.name, self.printcommand))
 
     def help(self, whatever = None):
         tkMessageBox.showinfo('Rhinote Help', message = '''
@@ -114,6 +119,23 @@ Free Software distributed under the GNU General Public License
 http://rhinote.tuxfamily.org
 ''')
 
+    def which(self, cmd):
+        # Abort immediately if PATH is not set
+        path = os.getenv('PATH')
+        if not path:
+            return None
+        # Look in all directories listed in PATH
+        dirs = path.split(os.pathsep)
+        path = None
+        for d in dirs:
+            f = os.path.join(d, cmd)
+            # f must be an executable file
+            if os.path.isfile(f) and os.access(f, os.X_OK):
+                # Stop after the first success
+                path = f
+                break
+        return path
+
     def __init__(self, master, **kw):
         Tkinter.Text.__init__(self, master, **kw)
         self.bind('<Control-n>', self.new_window)
@@ -135,6 +157,9 @@ http://rhinote.tuxfamily.org
         ('Rhinote files', '*.rhi'),
             ('All files', '*'),
             ]
+        # Find print and format commands
+        self.printcommand = self.which('lpr')
+        self.formatcommand = self.which('enscript')
 
 # make it so:
 if __name__ == '__main__':
